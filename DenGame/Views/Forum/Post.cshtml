@{
	ViewData["Title"] = "Post";
}
<!DOCTYPE html>
<html lang="en">

<head>
	<meta charset="UTF-8">
	<script src="~/lib/ckeditor5/ckeditor.js"></script>
	<link rel="stylesheet" href="css/editor.css">
	<link rel="stylesheet" href="~/css/post.css" asp-append-version="true" />
	<script src="https://cdn.ckeditor.com/ckeditor5/41.3.1/classic/ckeditor.js"></script>
	<script src="https://kit.fontawesome.com/b5dde33e16.js" crossorigin="anonymous"></script>
	<link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.3/dist/css/bootstrap.min.css" rel="stylesheet"
		  integrity="sha384-QWTKZyjpPEjISv5WaRU9OFeRpok6YctnYmDr5pNlyT2bRjXh0JMhjY6hW+ALEwIH" crossorigin="anonymous">
	<link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/bootstrap-icons@1.11.3/font/bootstrap-icons.min.css">
	<meta name="viewport" content="width=device-width, initial-scale=1.0">

</head>

<body>
	<div class="shadow border border-1 rounded w-75 m-auto mt-2">
		<form class="m-2">
			<h3 class="border-bottom p-2">發文</h3>
			<div class="form-row">
				<div id="closeLabel" class="form-group col-md-6 mb-4">
					<i class="bi bi-card-image"></i><label class="ms-1">封面</label>
					<input id="imageInput" type="file" class="form-control">
				</div>
				@* 移除button *@
					<button id="deleteImage" style="display:none;">移除</button>
				
				<div class="form-group mb-4">
					<i class="bi bi-vector-pen"></i><label class="ms-1">標題</label>
					<div class="input-group">
						<input id="textInput" type="text" class="form-control" maxlength="200" auto-height
							   placeholder="請輸入標題(必填)">
						<div class="input-group-append">
							<span id="charCount" class="input-group-text">0/200</span>
						</div>
					</div>
				</div>


				<div class="form-group mb-4">

					<!-- 富文本編輯器 -->
					<i class="bi bi-pencil-fill"></i><label class="ms-1">內文</label>

					<textarea id="editor" placeholder="請輸入正文"></textarea>
				</div>

				<div class="form-group mb-4">
					<label for="">分類</label><i class="bi bi-check-all"></i>
					<select name="" id="" class="form-control">
						<option value="">1</option>
						<option value="">2</option>
					</select>
				</div>
			</div>

			@* 預覽畫面 *@
			<div id="preview" class="preview">
				<div class="previewSide">
					<span class="close">&times;</span>
					<h3 id="previewTitle"></h3>
					<hr>
					<!-- user -->
					<div class="d-flex mb-3">
						<div>
							<img class="rounded-circle" style="width: 50px;"
								 src="https://upload-os-bbs.hoyolab.com/upload/2024/04/24/d6048f30e1ec7c52013ad5ed41500099_293482052564117040.png?x-oss-process=image%2Fresize%2Cs_600%2Fauto-orient%2C0%2Finterlace%2C1%2Fformat%2Cwebp%2Fquality%2Cq_80">
							</img>
						</div>
						<div class="ms-1">
							<span class="text-primary ">坂坂悠</span>

						</div>
					</div>
					<img id="previewImage" src="" alt="Image Preview" style="display:none;width:100%;height:500px;object-fit:cover;">
					<div id="previewContent"></div>
				</div>
			</div>
			<div class="row justify-content-center">
				@* 預覽BUTTON *@
				<div class="col-6 ">
					<div class="row justify-content-center">
						<button id="previewBtn" class="btn btn-light w-50">預覽</button>
					</div>

				</div>
				@* 發表BUTTON *@
				<div class="col-6 ">
					<div class="row justify-content-center">
						<button class="btn btn-light w-50">發表</button>
					</div>
				</div>
			</div>



		</form>

	</div>
	<script>
		var myEditor;
		ClassicEditor
			.create(document.querySelector('#editor'))
			.then(editor => {
				console.log(editor);
				myEditor = editor;
			})
			.catch(error => {
				console.error(error);
			});
		$(document).ready(function () {
			$('#imageInput').on('change', function (e) {
				var file = e.target.files[0];
				var reader = new FileReader();

				reader.onload = function (e) {
					var imageData = e.target.result;
					$('#closeLabel').after('<div id="imageDisplayArea" style="width:100%;margin-bottom:20px"></div>');
					$('#imageDisplayArea').html('<img src="' + imageData + '" alt="Selected Image" style="width:100%;height:500px;object-fit:cover;">');
					$('#closeLabel').css('display', 'none');
					$('#deleteImage').show();
				};

				reader.readAsDataURL(file);
			});
			//移除照片
			$('#deleteImage').on('click', function () {
				event.preventDefault();
				$('#imageDisplayArea').remove();
				$('#imageInput').val('');
				$('#deleteImage').hide();
				$('#closeLabel').show();
			});
			// 監聽字數
			$('#textInput').on('input', function () {
				var currentLength = $(this).val().length;
				$('#charCount').text(currentLength + '/200');
			});

			//預覽畫面
			$('#previewBtn').on('click', function () {
				event.preventDefault();

				var title = $('#textInput').val();
				var content = $('.editor').val();
				var image = $('#imageInput')[0].files[0];
				$('#previewTitle').text(title);
				$('#previewContent').html(myEditor.getData());

				if (image) {
					var reader = new FileReader();
					reader.onload = function (e) {
						$("#previewImage").attr("src", e.target.result).show();
					}
					reader.readAsDataURL(image);
				} else {
					$("#previewImage").hide();
				}
				$('#preview').show();
			});
			$('.close').on('click', function () {
				$('#preview').hide();
			});



		});


	</script>

</body>

</html>
